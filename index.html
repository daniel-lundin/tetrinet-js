<!DOCTYPE html>
<html>
  <head>
    <title>Tetrinet js</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="/socket.io/socket.io.js"></script>
    <script src="/static/js/drawing.js"></script>
    <script>

    var socket = io.connect('/');
    var player_id;

    socket.on('playfield_update', function(data) {
      var canvas = document.getElementById('canvas');
      draw_fields(canvas, data);
    });

    socket.on('id_assigned', function(data) {
      console.log("I'm player " + data);
      player_id = data;
    });

    document.onkeydown = function(e) {
      switch(e.keyCode) {
        case 37: // left
          socket.send('left');
          break;
        case 39:
          socket.send('right');
          break;
        case 38:
          socket.send('rotate');
          break;
        case 40:
          socket.send('down');
          break;
        case 32:
          socket.send('free_fall');
          break;
        default:
          console.log(e.keyCode)
          break;
      }
    }

    // Touch specifics
    document.ontouchend = function(e) {
      var t = e.changedTouches[0];
      if(t.pageX < 100) {
        socket.send('left');
      } else if(t.pageX > document.width - 100) {
        socket.send('right');
      } else if(t.pageY < 100) {
        socket.send('rotate');
      } else if(t.pageY > document.height - 100) {
        socket.send('free_fall');
      }
    }
    document.ontouchmove = function(e) {
      e.preventDefault();
    }
    </script>
  </head>
  <body>
    <canvas id="canvas" width="600" height="500"></canvas>
  </body>
</html>
